"use strict";Vue.component("e-picker",{template:'<div class="eui-modal" :class="{visible:visible}"\n         @touchmove.prevent="pickerHandler(\'move\', pickerType, $event)"\n         @touchend.stop="pickerHandler(\'end\')"\n         @click.prevent="pickerClick(false)">\n        <div class="eui-block absolute bottom" @click.stop="">\n            <div class="eui-card radius-top">\n                <div class="eui-card-header padding-lr-16 padding-tb-0">\n                    <div class="eui-block eui-list">\n                        <div class="eui-item">\n                            <div class="eui-item-left" @click="pickerClick(false)">\n                                <span class="eui-link">关闭</span>\n                            </div>\n                            <div class="eui-item-body flex-center">\n                                <span v-cloak="" class="fs-15 color-121415">{{title}}</span>\n                            </div>\n                            <div class="eui-item-right" @click="pickerClick(true)">\n                                <span class="eui-link">确定</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="eui-card-body no-padding">\n                    <div v-cloak="" v-if="showPickerTitle" class="flex-center padding-tb-5">\n                        <div v-for="title in pickerTitles" class="flex-center flex-equal">\n                            <span v-cloak="">{{title}}</span>\n                        </div>\n                    </div>\n                    <div class="picker relative">\n                        <div class="picker-mask"><div></div></div>\n                        <div class="picker-items" v-for="field in fields" @touchstart.stop="pickerHandler(\'start\', field, $event)">\n                            <div class="picker-item" :ref="\'picker-\' + field" :style="fieldStyle[field]">\n                                <div v-for="(item, index) in pickerOptions[field]" >\n                                    <span v-if="pickerKey" v-cloak  :class="{active: isActive(field, index) , next: isActive(field, index -1), prev: isActive(field, index + 1)}">{{item[pickerLabel]}}</span>\n                                    <span v-if="!pickerKey" v-cloak  :class="{active: isActive(field, index) , next: isActive(field, index -1), prev: isActive(field, index + 1)}">{{item}}</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>',props:{pickerKey:{type:String,default:""},pickerLabel:{type:String,default:""},title:{type:Boolean,default:""},showPickerTitle:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},pickerValue:{type:Object,default:{}},pickerFields:{type:Object,default:{}},pickerOptions:{type:Array,default:[]}},data:function(){return{speed:1,itemHeight:38,pickerType:"",positionY:null,pickerEle:null}},computed:{fields:function(){return Object.keys(this.pickerFields)},pickerTitles:function(){var i=this;return Object.keys(i.pickerFields).map(function(e){return i.pickerFields[e].label})},fieldStyle:function(){var c=this,n=c.itemHeight;return c.fields.reduce(function(e,i){var t,r=c.pickerOptions[i],l=c.pickerValue[i];return l?(t=c.pickerKey?(r=r.map(function(e){return e[c.pickerKey]})).indexOf(l[c.pickerKey]):r.indexOf(l),e[i]={height:c.pickerOptions[i].length*n+"px",top:(2-t)*n+"px"}):e[i]={height:c.pickerOptions[i].length*n+"px",top:3*n+"px"},e},{})}},methods:{isActive:function(e,i){var t=this.pickerKey,r=this.pickerValue[e],l=this.pickerOptions[e][i];return t&&r&&l?r[t]===l[t]:r===l},pickerHandler:function(e,i,t){var r,l,c,n,p,a,s,d,k,o,u,v,f,y=this;"start"===e?(y.pickerType=i,y.pickerEle=y.$refs["picker-"+i][0],(r=t.targetTouches&&t.targetTouches[0])&&(y.positionY=r.pageY)):"end"===e?(l=y.itemHeight,y.pickerType&&(c=y.pickerOptions[y.pickerType],n=getComputedStyle(y.pickerEle),s=(2-(p=c.length-1))*l,f=p<=(f=2-(d=(a=2*l)<=(d=Math.round(parseInt(n.top)/l)*l)?a:d<=s?s:d)/l)?p:f<=0?0:f,y.pickerEle.style.top=d+"px",y.pickerValue[y.pickerType]=c[f],"year"!==y.pickerType&&"month"!==y.pickerType||(k=y.pickerValue.year,o=y.pickerValue.month,u=util.date.getMaxDates(k,o),y.pickerValue.date>u&&(y.pickerValue.date=u,y.$refs["picker-date"][0].style.top=(2-u)*l+"px")),"workType1"===y.pickerType&&(v=y.pickerValue.workType1,y.pickerOptions.workType2=v?v.children:[]),y.$forceUpdate(),y.pickerType="",y.positionY=null,y.pickerEle=null)):"move"===e&&util.app.debounce(50,function(){var e,i;y.pickerEle&&(e=getComputedStyle(y.pickerEle),(i=t.targetTouches&&t.targetTouches[0])&&(y.pickerEle.style.top=parseInt(e.top)+(i.pageY-y.positionY)*y.speed+"px",y.positionY=i.pageY))})},pickerClick:function(e){var i=this,t=i.fields.filter(function(e){return null!==i.pickerValue[e]&&void 0!==i.pickerValue[e]}),r=e&&t.length===i.fields.length?i.pickerValue:null;i.$emit("event-picker-callback",!1,r)}}}),Vue.component("e-date-picker",{template:'<e-picker title="请选择时间" :visible="visible" :show-picker-title="true" :picker-value="pickerValue" :picker-fields="pickerFields" :picker-options="pickerOptions" @event-picker-callback="pickerCallback"></e-picker>',props:{pickerValue:{type:Object,default:{year:"",month:"",date:""}},visible:{type:Boolean,default:!1},pickerFields:{type:Object,default:{year:{label:"年",name:"year"},month:{label:"月",name:"month"},date:{label:"日",name:"date"}}}},data:function(){return{itemHeight:38,showPickerTitle:!0}},computed:{pickerOptions:function(){var e=(new Date).getFullYear(),i={year:util.array.numberArray(e-2,e+2),month:util.array.numberArray(1,12),date:util.array.numberArray(1,util.date.getMaxDates(this.pickerValue.year,this.pickerValue.month)),hour:util.array.numberArray(0,23),minute:util.array.numberArray(0,59),second:util.array.numberArray(0,59)};return i}},methods:{pickerCallback:function(e,i){this.$emit("event-picker-callback",e,i)}}});